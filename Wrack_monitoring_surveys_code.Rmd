---
title: "Wrack_monitoring_surveys"
author: "Ric DeSantiago"
date: "2023-01-30"
output: html_document
---

# Library
```{r}
library(knitr)
library(jtools)
library(tidyverse)
library(tidyr)
library(ggplot2)
library(ggfortify)
library(lme4)
library(car)
library(nlme)
library(ggpubr)
library(multcompView)
library(boot)
library(Hotelling)
library(mvnTest)
library(vegan)
library(factoextra)
library(FactoMineR)
library(agricolae)
library(glmm)
library(HH)
library(ggpubr)
library(rstatix)
#hi
```


# Wrack line surveys (ellipse)
```{r}

#Q1: What are the dominant seaweed species that make up wrack piles?
  #Do these differ per site? per year?

#Q2: what proportion of surface area of wrack piles consist of S. horneri?


#Q1 
#upload data 
Wrack <- read.csv("wrack_line_survey.csv") 
Wrack<-subset(Wrack, !year== "2020")
Wrack$trip<-as.factor(Wrack$trip)
# Subset the data to remove NAs
Wrack <- subset(Wrack, Dominant_species != "na")


#quick look at total wrack area by site over time showing the dominant species of the pile
Wrack %>%
  ggplot() +
  aes(x = site, fill = Dominant_species, weight = ellipse_A_m2) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  labs(y = "Area wrack area (m^2)", x = "") +
  facet_grid(vars(trip), vars()) +
  ggtitle("Total area of wrack") +  
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))  

#### M. pyrifera is the dominant species in wrack piles 

#Q2
horneri<-subset(Wrack, sarg == "y")
view(horneri)

# mean and SE
mean_percent <- mean(horneri$percent)
se_percent <- sd(horneri$percent) / sqrt(length(horneri$percent))

#results
cat(mean_percent, "\n")
cat(se_percent, "\n")

##S. horneri consisted of 2.4 +/- 1.6% of the surface area of wrack piles


# lets look at this by site at each time point 
horneri_summary <- horneri %>%
  group_by(trip) %>%
  summarize(
    mean_percent = mean(percent),
    se_percent = sd(percent) / sqrt(n())
  )
# Print the summary
print(horneri_summary)

#S. horneri consisted of 4.8 +/- 3.3% during March and 0.6 +/- 0.4% in May


```


##Manuscript figure 
```{r}
#####make graph for manuscript
# Remove NA from species
Wrack <- subset(Wrack, Dominant_species != "na")
# Replace trips for  month
Wrack <- Wrack %>%
  mutate(trip_label = case_when(
    trip == "1" ~ "Mar.",
    trip == "2" ~ "May",
    trip == "3" ~ "Sep.",
    trip == "4" ~ "Dec.",
    TRUE ~ as.character(trip)
  ))

# keep labels in chronological order
Wrack$trip_label <- factor(Wrack$trip_label, levels = c("Mar.", "May", "Sep.", "Dec."))

# Pplot 
wrack_piles <-Wrack %>%
  ggplot() +
  aes(x = site, fill = Dominant_species, weight = ellipse_A_m2) +
  geom_bar() +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  labs(y = expression("Area of wrack" ~ (m^2)), x = "") +
  facet_grid(vars(trip_label), vars()) +  
  ggtitle("Total area of wrack") +
  labs(fill = "Dominant species") + 
  theme(panel.border = element_rect(color = "black", fill = NA, size = 0.5))

wrack_piles

wrack_piles +
  theme(
    axis.text = element_text(size = 14),   
    axis.title = element_text(size = 15),    
    plot.title = element_text(size = 18),     
    legend.title = element_text(size = 16), 
    legend.text = element_text(size = 14),  
    strip.text = element_text(size = 14)      
  )

```


#Beach wrack (Dugan)
```{r}

#load data
beachwrack<-read.csv("beach_wrack.csv", header = T)
beachwrack$Trip<-as.factor(beachwrack$Trip)
beachwrack$length<-as.factor(beachwrack$length)
beachwrack$seaweed_per_beach<-as.numeric(beachwrack$seaweed_per_beach)
beachwrack<- subset(beachwrack, site != "Bachelor")

#lets explore look at seaweed hits on the transect by site by species over time at each site
#remove the zero hits
beachwrack_hits <- subset(beachwrack, hits != 0)


#look at hits by species per site
ggplot(beachwrack_hits) +
 aes(x = site, fill = species, weight = hits) +
 geom_bar(position = "dodge") +
 scale_fill_hue(direction = 1) +
 theme_minimal() +
 facet_grid(vars(), vars(Trip))


# Calculate means and standard errors for hits
means_se <- beachwrack %>%
  group_by(site, species, Trip) %>%
  summarize(mean_hits = mean(hits),
            se_hits = sd(hits) / sqrt(n()))

# Plot the data with means and standard errors for number of hits by species by site over time
ggplot(means_se, aes(x = site, y = mean_hits, fill = species)) +
  geom_bar(position = position_dodge(width = 1), stat = "identity") +
  geom_errorbar(aes(ymin = mean_hits - se_hits, ymax = mean_hits + se_hits),
                position = position_dodge(width = 1), width = 0.25) +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  labs(y = "Number of occurences") +
  facet_grid(vars(Trip))





# Plot the data with means and standard errors for the number of hits by species by site over time
ggplot(means_se, aes(x = site, y = mean_hits, fill = species)) +
  geom_bar(position = position_dodge(width = 1), stat = "identity") +
  geom_errorbar(aes(ymin = mean_hits - se_hits, ymax = mean_hits + se_hits),
                position = position_dodge(width = 1), width = 0.25) +
  scale_fill_hue(direction = 1) +
  theme_minimal() +
  labs(y = "Number of occurrences") +
  facet_grid(vars(Trip)) +
  ggtitle("Mean occurence of of  Species and Site Over Time") +  # Add title
  theme(legend.title = element_text(face = "bold"),  # Capitalize legend
        panel.border = element_rect(color = "black", fill = NA, size = 1))  # Add thin black frame around the graph





#lets look at number of occurences by length of seaweed fragment

#create means and se for frequency of lengths of each species by site over time
frag_means_se <- beachwrack %>%
  group_by(species, Trip, length) %>%
  summarize(frag_means_se = mean(hits),
            frag_se_hits = sd(hits) / sqrt(n()))

ggplot(frag_means_se, aes(x = length, y = frag_means_se, fill = species)) +
  geom_bar(position = position_dodge(width = 1), stat = "identity") +
  geom_errorbar(aes(ymin = frag_means_se - frag_se_hits, ymax = frag_means_se + frag_se_hits),
                position = position_dodge(width = 1), width = 0.25) +
   scale_fill_hue(direction = 1) +
 labs(x = "Fragment length (mm)", y = "Number of occurences", fill = "Species") +
 theme_minimal() +
 facet_grid(vars(Trip), vars())




#lets look at length of seaweed per length of beach in terms of meters of wrack per meters of sandy beach

#since all the values are placed along the column that IDs 16mm seaweeds we can use that to subset those and not deal with the other NA'd columns
length_survey<-subset(beachwrack, length == "16")
view(length_survey)

#create mean and se for graphs
length_means <- length_survey %>%
  group_by(Trip, site, species) %>%
  summarize(seaweed_per_beach_mean = mean(seaweed_per_beach),
            length_se = sd(seaweed_per_beach) / sqrt(n()))

ggplot(length_means, aes(x = site, fill = species, y = seaweed_per_beach_mean)) +
geom_bar(position = position_dodge(width = 1), stat = "identity") +
  geom_errorbar(aes(ymin = seaweed_per_beach_mean - length_se, ymax = seaweed_per_beach_mean + length_se),
                position = position_dodge(width = 1), width = 0.25) +
 scale_fill_hue(direction = 1) +
   labs(x = "Site", y = "Length of seaweed per length of beach (m)", fill = "Species") +
 theme_minimal() +
 facet_grid(vars(Trip), vars())


```

#Timed search
```{r}
timed<-read.csv("Sargassum_time_search.csv", header = T)
view(timed)

timed$Trip<-as.factor(timed$Trip)



library(ggplot2)

ggplot(timed) +
 aes(x = Site, y = occurances) +
 geom_col(fill = "#112446") +
 theme_minimal() +
   labs(y = "Number of S. horneri occurences") +
 facet_grid(vars(Trip), 
 vars())
```

#Ab food retention
```{r}
food<-read.csv("ab_food_retention.csv", header = T)
view(food)
food$Cycle<-as.factor(food$Cycle)
food$Site<-as.factor(food$Site)
esquisse::esquisser()



ggplot(food) +
 aes(x = Cycle, weight = Observation) +
 geom_bar(fill = "#112446") +
 theme_minimal()

esquisse::esquisser()



ggplot(food) +
 aes(x = Food, y = Observation) +
 geom_col(fill = "#112446") +
 theme_minimal()


```







